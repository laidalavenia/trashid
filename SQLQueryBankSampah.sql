-- Generated by Oracle SQL Developer Data Modeler 23.1.0.087.0806
--   at:        2023-10-08 19:19:58 ICT
--   site:      Oracle Database 11g
--   type:      Oracle Database 11g



-- predefined type, no DDL - MDSYS.SDO_GEOMETRY

-- predefined type, no DDL - XMLTYPE

CREATE TABLE jenis_sampah (
    jenis_sampah_id    VARCHAR(5) NOT NULL,
    nama_jenis_sampah  VARCHAR(20),
    harga_per_kg       numeric,
    stok_sampah_per_kg INTEGER,
    deskripsi          VARCHAR(4000)
);
select * from jenis_sampah;

ALTER TABLE jenis_sampah ADD CONSTRAINT jenis_sampah_pk PRIMARY KEY ( jenis_sampah_id );

CREATE TABLE jenis_transaksi (
    jenis_transaksi_id VARCHAR(5) NOT NULL,
    keterangan         VARCHAR(20)
--  ERROR: Datatype UNKNOWN is not allowed 

);

ALTER TABLE jenis_transaksi ADD CONSTRAINT jenis_transaksi_pk PRIMARY KEY ( jenis_transaksi_id );

CREATE TABLE nasabah (
    nasabah_id        VARCHAR(5) NOT NULL,
    nama              CHAR(50),
    alamat            VARCHAR(4000),
    no_telp           VARCHAR(20) NOT NULL,
    email             CHAR(50),
    jenis_kelamin     CHAR(20),
    tanggal_bergabung DATE
);

ALTER TABLE nasabah ADD CONSTRAINT nasabah_pk PRIMARY KEY ( nasabah_id );

CREATE TABLE pemasok (
    pemasok_id VARCHAR(5) NOT NULL,
    nama       VARCHAR(30),
    alamat     VARCHAR(4000),
    no_telp    CHAR(20) NOT NULL,
    email      CHAR(30)
);

ALTER TABLE pemasok ADD CONSTRAINT pemasok_pk PRIMARY KEY ( pemasok_id );

CREATE TABLE pengambilan_sampah (
    pengambilan_id                     VARCHAR(5) 
--  ERROR: VARCHAR2 size not specified 
     NOT NULL,
    tanggal_pengambilan                DATE,
    jumlah_diambil                     INTEGER, 
--  ERROR: Column name length exceeds maximum allowed length(30) 
    jenis_transaksi_jenis_transaksi_id VARCHAR(5) NOT NULL
);

ALTER TABLE pengambilan_sampah ADD CONSTRAINT pengambilan_sampah_pk PRIMARY KEY ( pengambilan_id );

CREATE TABLE penjualan_sampah (
    penjualan_id                 VARCHAR(5) NOT NULL,
    tanggal_penjualan            DATE,
    jumlah_terjual               INTEGER,
    pendapatan                   numeric,
    jenis_sampah_jenis_sampah_id VARCHAR(5) NOT NULL,
    pemasok_pemasok_id           VARCHAR(5) NOT NULL
);

ALTER TABLE penjualan_sampah ADD CONSTRAINT penjualan_sampah_pk PRIMARY KEY ( penjualan_id );

CREATE TABLE penyetoran_sampah (
    penyetoran_id                      VARCHAR(5) NOT NULL,
    tanggal_penyetoran                 DATE,
    jumlah_setoran                     INTEGER, 
--  ERROR: Column name length exceeds maximum allowed length(30) 
    jenis_transaksi_jenis_transaksi_id VARCHAR(5) NOT NULL
);

ALTER TABLE penyetoran_sampah ADD CONSTRAINT penyetoran_sampah_pk PRIMARY KEY ( penyetoran_id );

CREATE TABLE transaksi (
    transaksi_id                       VARCHAR(5) NOT NULL,
    tanggal_transaksi                  DATE,
    berat_kg                           INTEGER,
    jumlah_uang                        numeric,
    jenis_sampah_jenis_sampah_id       VARCHAR(5) NOT NULL,
    nasabah_nasabah_id                 VARCHAR(5) NOT NULL, 
--  ERROR: Column name length exceeds maximum allowed length(30) 
    jenis_transaksi_jenis_transaksi_id VARCHAR(5) NOT NULL
);

ALTER TABLE transaksi ADD CONSTRAINT transaksi_pk PRIMARY KEY ( transaksi_id );

--  ERROR: FK name length exceeds maximum allowed length(30) 
ALTER TABLE pengambilan_sampah
    ADD CONSTRAINT pengambilan_sampah_jenis_transaksi_fk FOREIGN KEY ( jenis_transaksi_jenis_transaksi_id )
        REFERENCES jenis_transaksi ( jenis_transaksi_id );

--  ERROR: FK name length exceeds maximum allowed length(30) 
ALTER TABLE penjualan_sampah
    ADD CONSTRAINT penjualan_sampah_jenis_sampah_fk FOREIGN KEY ( jenis_sampah_jenis_sampah_id )
        REFERENCES jenis_sampah ( jenis_sampah_id );

ALTER TABLE penjualan_sampah
    ADD CONSTRAINT penjualan_sampah_pemasok_fk FOREIGN KEY ( pemasok_pemasok_id )
        REFERENCES pemasok ( pemasok_id );

--  ERROR: FK name length exceeds maximum allowed length(30) 
ALTER TABLE penyetoran_sampah
    ADD CONSTRAINT penyetoran_sampah_jenis_transaksi_fk FOREIGN KEY ( jenis_transaksi_jenis_transaksi_id )
        REFERENCES jenis_transaksi ( jenis_transaksi_id );

ALTER TABLE transaksi
    ADD CONSTRAINT transaksi_jenis_sampah_fk FOREIGN KEY ( jenis_sampah_jenis_sampah_id )
        REFERENCES jenis_sampah ( jenis_sampah_id );

ALTER TABLE transaksi
    ADD CONSTRAINT transaksi_jenis_transaksi_fk FOREIGN KEY ( jenis_transaksi_jenis_transaksi_id )
        REFERENCES jenis_transaksi ( jenis_transaksi_id );

ALTER TABLE transaksi
    ADD CONSTRAINT transaksi_nasabah_fk FOREIGN KEY ( nasabah_nasabah_id )
        REFERENCES nasabah ( nasabah_id );



-- Oracle SQL Developer Data Modeler Summary Report: 
-- 
-- CREATE TABLE                             8
-- CREATE INDEX                             0
-- ALTER TABLE                             15
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- REDACTION POLICY                         0
-- 
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
-- 
-- ERRORS                                   9
-- WARNINGS                                 0

insert into nasabah (nasabah_id, nama, alamat, no_telp, email, jenis_kelamin, tanggal_bergabung) 
values
('n2', 'Sri Wahyuni', 'Jalan Kenangan No. 456 Arjasa', '081234567895', 'sriwahyuni@gmail.com', 'perempuan','2020-02-05'),
('n3', 'Yanti Susanti', 'Jalan Kelinci No. 101 Sumbersari', '081234567897', 'yantis@gmail.com', 'perempuan', '2020-02-01'),
('n4', 'Hadi Pramono', 'Jalan Mawar No. 113 Arjasa', '081234567898', 'hadipr@gmail.com', 'laki-laki','2020-02-15'),
('n5', 'Iwan Setiawan', 'Jalan Melati No. 213 Patrang', '081234567891', 'iwansetiawan@gmail.com', 'laki-laki','2020-02-16'),
('n6', 'Adi Nugroho', 'Jalan Sekar No. 21 Sumbersari', '081234567908', 'adinug@gmail.com', 'laki-laki','2020-02-17'),
('n7', 'Budi Santoso', 'Jalan Durian No. 13 Pakusari', '085234027891', 'budisantoso@gmail.com', 'laki-laki','2020-02-20'),
('n8', 'David Johnson', 'Jalan Mangga No. 28 Sumbersari', '083834997891', 'davidjohnson@gmail.com', 'laki-laki','2020-02-25'),
('n9', 'Jennifer Smith', 'Jalan Damai No. 32 Patrang', '087832716498', 'jennifersm@gmail.com', 'perempuan','2020-03-03'),
('n10', 'Yeni Aina', 'Jalan Riau No.10 Sumbersari', '085234502518', 'yeni153@gmail.com', 'perempuan','2020-03-18');



ALTER TABLE pemasok ADD jenis_kelamin char(20);

select * from pemasok;

insert into jenis_transaksi (jenis_transaksi_id, keterangan) 
values
('js1', 'pengambilan sampah'),
('js2', 'penyetoran sampah');

insert into pengambilan_sampah (pengambilan_id, tanggal_pengambilan, jumlah_diambil, jenis_transaksi_jenis_transaksi_id) 
values
('ps1', '2020-04-10', 2, 'js1'),
('ps2', '2020-04-09', 1, 'js1'),
('ps3', '2020-04-08', 2, 'js1'),
('ps4', '2020-04-11', 5, 'js1'),
('ps5', '2020-04-13', 2, 'js1'),
('ps6', '2020-04-14', 3, 'js1'),
('ps7', '2020-04-17', 2, 'js1'),
('ps8', '2020-04-20', 4, 'js1'),
('ps9', '2020-04-25', 3, 'js1'),
('ps10', '2020-05-01', 2, 'js1');

insert into penyetoran_sampah (penyetoran_id, tanggal_penyetoran, jumlah_setoran, jenis_transaksi_jenis_transaksi_id) 
values
('py1', '2020-04-11', 2, 'js2'),
('py2', '2020-04-19', 1, 'js2'),
('py3', '2020-04-18', 2, 'js2'),
('py4', '2020-04-01', 5,'js2'),
('py5', '2020-04-14', 2, 'js2'),
('py6', '2020-04-15', 3, 'js2'),
('py7', '2020-04-14', 2, 'js2'),
('py8', '2020-04-21', 4, 'js2'),
('py9', '2020-04-26', 3, 'js2'),
('py10', '2020-04-03', 2, 'js2');


insert into jenis_sampah (jenis_sampah_id, nama_jenis_sampah, harga_per_kg, stok_sampah_per_kg, deskripsi)
values 
('jsm1', 'plastik', 5000, 20, null),
('jsm2', 'kertas', 3000, 10, null),
('jsm3', 'besi', 8000, 30, null),
('jsm4', 'karet', 6000, 15, null);

select * from penjualan_sampah;

ALTER TABLE penjualan_sampah
ADD harga_per_kg numeric;

ALTER TABLE penjualan_sampah DROP COLUMN penjualan_i;

ALTER TABLE penjualan_sampah
ADD penjualan_id varchar(5) primary key;

insert into penjualan_sampah (penjualan_id, tanggal_penjualan, jumlah_terjual, pendapatan, jenis_sampah_jenis_sampah_id, pemasok_pemasok_id, harga_per_kg)
values 
('pj1', '2020-04-11', 3, null, 'jsm1', 'p1', 5000),
('pj2', '2020-04-12', 2, null, 'jsm1', 'p1', 5000),
('pj3', '2020-04-14', 3, null, 'jsm2', 'p1', 3000),
('pj4', '2020-04-14', 4, null, 'jsm3', 'p1', 8000),
('pj5', '2020-04-15', 6, null, 'jsm4', 'p1', 6000);

UPDATE penjualan_sampah
SET pendapatan = jumlah_terjual * harga_per_kg;

--[[MENGHITUNG KEUNTUNGAN PEMASOK, MASUK KE KOLOM PENDAPATAN]]

ALTER TABLE penjualan_sampah
ADD keuntungan numeric;

select * from penjualan_sampah;

UPDATE penjualan_sampah
SET keuntungan = 3000
WHERE penjualan_id = 'pj4';

update penjualan_sampah
set pendapatan = (harga_per_kg * jumlah_terjual) + keuntungan
where penjualan_id = 'pj4';

--===
--TRANSAKSI

select * from transaksi

ALTER TABLE transaksi
ADD harga_per_kg numeric;

insert into transaksi (transaksi_id, tanggal_transaksi, berat_kg, jumlah_uang, jenis_sampah_jenis_sampah_id, nasabah_nasabah_id, jenis_transaksi_jenis_transaksi_id, harga_per_kg)
values 
('t1', '2020-04-09', '1', null, 'jsm2', 'n3', 'js1', 3000 ),
('t2', '2020-04-11', '2', null, 'jsm1', 'n1', 'js2', 5000 ),
('t3', '2020-04-01', '5', null, 'jsm3', 'n2', 'js2', 8000 ),
('t4', '2020-04-14', '3', null, 'jsm1', 'n3', 'js1', 5000 ),
('t5', '2020-04-25', '3', null, 'jsm4', 'n3', 'js1', 6000 );

UPDATE transaksi
SET jumlah_uang= berat_kg * harga_per_kg;

--====

